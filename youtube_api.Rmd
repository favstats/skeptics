---
title: "Skeptic Community"
output: html_notebook
---

# Packages

```{r}
#devtools::install_github("soodoku/tuber")

pacman::p_load(tidyverse, tuber, magrittr, stringi, qdapRegex, purrr, lubridate, ggthemes, httr, plyr)

options(scipen = 99999)

```

# Authentication

```{r}
key <- "AIzaSyDmV5jHx7c8GeAmpTkv6To_ERdkZ_HNl70"

client_id <- "580511698053-p8mu77kktkcvb503g9q737svu9gcq101.apps.googleusercontent.com"

client_key <- "Y0eW96yy-WRg90RZjVJS615o"

tuber::yt_oauth(client_id, client_key)

```



# Video Details

Hier gibt es zum Beispiel:

- Tags
- Published Time
- Titles

```{r}

#amazingatheist_details <- purrr::map(amazingatheist_ids, get_video_details)
#save(amazingatheist_details, file = "data/amazingatheist_details.Rdata")

extract_details <- function(video_ids) {
cat("Getting the details now.. \n")
  video_ids_details <- purrr::map(video_ids, get_video_details)
  
cat("1) Extracting Youtuber \n")

channel <- video_ids_details[[1]]$items[[1]]$snippet$channelTitle

cat("2) Extracting Dates \n")

publishedAt <- vector()
for (jj in seq_along(video_ids)) {
  publishedAt[[jj]] <- video_ids_details[[jj]]$items[[1]]$snippet$publishedAt # time
  }


date <- publishedAt %>% 
  as_date()

cat("3) Extracting Titles \n")

titles <- vector()
for (jj in seq_along(video_ids)) {
  titles[[jj]] <- video_ids_details[[jj]]$items[[1]]$snippet$title # titles
  }


cat("4) Extracting Tags \n")


tags <- list()
for (jj in seq_along(video_ids)) {
  tags[[jj]] <- video_ids_details[[jj]]$items[[1]]$snippet$tags # tags
  }

cat("5) Extracting Video IDs \n")

id <- vector()
  for (jj in seq_along(video_ids)) {
  id[[jj]] <- video_ids_details[[jj]][["items"]][[1]][["id"]]
  }


details <- tibble(channel, id, date, titles, tags)

cat("6) Extracting Video Statistics \n")


stats <- map_df(video_ids, get_stats) %>% 
  mutate_at(vars(viewCount, likeCount, 
                 dislikeCount, favoriteCount,
                 commentCount),
            as.numeric)

details <- left_join(details, stats, by = "id")

cat("Done!")
return(details)
}

# armored_details <- extract_details(armored_ids)
# amazingatheist_details <- extract_details(amazingatheist_ids)
# logicked_details <- extract_details(logicked_ids) 
# thunder_details <- extract_details(thunder_ids)
# sargon_details <- extract_details(sargon_ids)
cultofdusty_details <- extract_details(cultofdusty_ids)

# save(armored_details, file = "data/armored_details.Rdata")
# save(amazingatheist_details, file = "data/amazingatheist_details.Rdata")
# save(logicked_details, file = "data/logicked_details.Rdata")
# save(thunder_details, file = "data/thunder_details.Rdata")
# save(sargon_details, file = "data/sargon_details.Rdata")
save(cultofdusty_details, file = "data/cultofdusty_details.Rdata")
```

## load details

```{r}
load("data/armored_details.Rdata")
load("data/amazingatheist_details.Rdata")
load("data/logicked_details.Rdata")
load("data/thunder_details.Rdata")
#load("data/sargon_details.Rdata")
load("data/cultofdusty_details.Rdata")
```

# Plot Preparation function

```{r}
plot_data <- function(comments_dat, details, youtuber, save = F) {
  
comments_dat %<>% 
  mutate(comment = str_to_lower(textOriginal)) %>% 
  mutate(date_posted = as_date(publishedAt)) %>% 
  mutate(id = videoId) %>% 
  mutate(author = authorDisplayName) %>% 
  mutate(likes = as.numeric(likeCount)) %>% 
  select(id, author, likes, date_posted, comment)
  
  sjw_keywords <- paste("blm", "black lives matter", "feminis", "race", "racis", "sexis", "postmodern", "marx", "antifa", "pc", "political correctness", "regressive", "safe space", "social justice", "warrior", sep = "|")
  
  
sjw_dat <- comments_dat %>% 
  mutate(sjw = ifelse(str_detect(comment, sjw_keywords), 1, 0)) %>% 
  ddply(.(id), summarise, n_sjw = sum(sjw)) 
#  group_by(id) %>% 
#  summarise(n_sjw = sum(sjw))

  religion_keywords <- paste("god", "creation", "heaven", "hell", "relig", "theis", "paradise", "salvation", "religtard", sep = "|")

religion_dat <- comments_dat %>% 
  mutate(religion = ifelse(str_detect(comment, religion_keywords), 1, 0)) %>% 
  ddply(.(id), summarise, n_religion = sum(religion)) 
#  group_by(id) %>% 
#  summarise(n_religion = sum(religion))

total_dat <- comments_dat %>% 
  group_by(id) %>% 
  tally() %>% 
  mutate(total = n) %>% 
  select(id, total)

gg_dat <- left_join(sjw_dat, religion_dat, by = "id") %>% 
  left_join(total_dat, by = "id") %>% 
  gather(term, comment_freq, n_sjw:n_religion, factor_key = TRUE) %>% 
  mutate(term = ifelse(term == "n_sjw", "SJW", "Religion")) %>% 
  left_join(details, by = "id") %>% 
  mutate(comment_prop = comment_freq / total)

if (save == T) save(gg_dat, file = paste0("data/gg_", youtuber, ".Rdata"))

return(gg_dat)

}
```


# Comments

## Armored Skeptic

```{r}
# armored_comments %<>% bind_rows
# save(armored_comments, file = "data/armored_comments.Rdata")

load("data/armored_comments.Rdata")

gg_armored <- plot_data(armored_comments, armored_details, "armored", save = T)

r_vs_sjw_armored <- gg_armored %>% 
  ggplot(aes(date, comment_prop, group = term, color = term)) + 
  geom_point(aes(size = viewCount, alpha = 0.2)) +
  geom_step() +
  geom_smooth() +
  guides(size = F, alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Topic") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in Armored Skeptic's Comments") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video")

ggsave(r_vs_sjw_armored, file = "images/r_vs_sjw_armored.png", width = 9, height = 6)

r_vs_sjw_armored
```

### Correlation

```{r}
gg_armored %>% 
  ggplot(aes(date, viewCount, group = term, color = term)) +
  geom_point(aes(size = comment_prop, alpha = 0.8)) +
  geom_step(color = "black") +
  geom_smooth(color = "darkgreen", alpha = 0.1) +
  guides(size = F, alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Term")

gg_armored %>% 
  ggplot(aes(date, likeCount, group = term, color = term)) +
  geom_point(aes(size = comment_prop, alpha = 0.8)) +
  geom_step(color = "black") +
  geom_smooth(color = "darkgreen", alpha = 0.1) +
  guides(size = F, alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Term")

gg_armored %>% 
  ggplot(aes(date, dislikeCount, group = term, color = term)) +
  geom_point(aes(size = comment_prop, alpha = 0.8)) +
  geom_step(color = "black") +
  geom_smooth(color = "darkgreen", alpha = 0.1) +
  guides(size = F, alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Term")
```


### Comment Level

```{r}
armored_comments %>% 
  mutate(id = videoId) %>% 
  left_join(armored_details, by = "id") %>%
  mutate(sjw = as.factor(ifelse(str_detect(textOriginal, as.character(sjw_keywords)), 1, 0))) %>% 
  ggplot(aes(as.numeric(date), viewCount, group = sjw, fill = sjw)) + 
  geom_area(aes(y = sjw, position = "fill"))

gg_armored %>% 
#  filter(term == "SJW") %>% 
    ggplot(aes(date, viewCount, group = term, fill = term)) + 
  geom_area(aes(y = comment_prop), size = 1, position = "fill", colour = "black" )
  
```



## Logicked

### Comments

```{r}

load("data/logicked_comments.Rdata")

gg_logicked <- plot_data(logicked_comments, logicked_details, "logicked")


r_vs_sjw_logicked <- gg_logicked %>% 
  ggplot(aes(date, comment_prop, group = term, color = term)) + 
  geom_point(aes(size = comment_prop, alpha = 0.2)) +
  geom_step() +
  geom_smooth() +
  guides(size = F, alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Topic") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in Logicked's Comments") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video")

ggsave(r_vs_sjw_logicked, file = "images/r_vs_sjw_logicked.png", width = 9, height = 6)

r_vs_sjw_logicked
```


## Amazing Atheist

### Comments

```{r}
load("data/amazingatheist_comments.Rdata")

#gg_amazingatheist <- plot_data(amazingatheist_comments, amazingatheist_details)

load("data/gg_amazingatheist.Rdata")
```


## thunderfoot

### Comments

```{r}

load("data/thunder_comments.Rdata")

gg_thunder <- plot_data(thunder_comments, thunder_details, "thunder")


r_vs_sjw_thunder <- gg_thunder %>% 
  ggplot(aes(date, comment_prop, group = term, color = term)) + 
  geom_vline(aes(xintercept=as.Date("2014-08-01")), linetype = 2) +
  geom_vline(aes(xintercept=as.Date("2012-08-01")), linetype = 2) +
  geom_point(aes(alpha = 0.2)) +
#  geom_step() +
  geom_smooth() +
  guides(size = F, alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Topic") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in thunderf00t's Comments") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video")

ggsave(r_vs_sjw_thunder, file = "images/r_vs_sjw_thunder.png", width = 9, height = 6)

r_vs_sjw_thunder

```

## Sargon of Akkad

### Comments

```{r}

# load("data/sargon_comments.Rdata")

gg_sargon <- plot_data(sargon_comments, sargon_details)


r_vs_sjw_sargon <- gg_sargon %>% 
  ggplot(aes(date, comment_prop, group = term, color = term)) + 
  geom_point(aes(size = comment_prop, alpha = 0.2)) +
#  geom_step() +
  geom_smooth() +
  guides(size = F, alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Topic") +
  ggtitle("Mentions of 'Religion' and 'SJW' in Sargon of AKkad's Comments") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video")

ggsave(r_vs_sjw_sargon, file = "images/r_vs_sjw_sargon.png", width = 7, height = 5)

```

## Cult of Dusty

### Comments

```{r}
# load("data/cultofdusty_comments.Rdata")

gg_cultofdusty <- plot_data(cultofdusty_comments, 
                            cultofdusty_details, 
                            "cultofdusty", save = T)


r_vs_sjw_cultofdusty <- gg_cultofdusty %>% 
  ggplot(aes(date, comment_prop, group = term, color = term)) + 
  geom_point(aes(size = comment_prop, alpha = 0.2)) +
#  geom_step() +
  geom_smooth() +
  guides(size = F, alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Topic") +
  ggtitle("Mentions of 'Religion' and 'SJW' in Cult of Dusty's Comments") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video")

ggsave(r_vs_sjw_cultofdusty, file = "images/r_vs_sjw_cultofdusty.png", width = 7, height = 5)

r_vs_sjw_cultofdusty

```


## All together

```{r}
gg_amazingatheist <- get(load("data/gg_amazingatheist.Rdata"))
gg_armored <- get(load("data/gg_armored.Rdata"))
gg_logicked <- get(load("data/gg_logicked.Rdata"))
gg_cultofdusty <- get(load("data/gg_cultofdusty.Rdata"))
gg_thunder        <- get(load("data/gg_thunder.Rdata"))

gg_all <- rbind(gg_amazingatheist,
                gg_armored,
                gg_cultofdusty,
                gg_logicked,
                gg_thunder)  %>% 
  mutate(Views = viewCount) %>% 
  mutate(date = as_date(date)) %>% 
  mutate(channel = as.factor(channel)) %>% 
  mutate(channel = factor(channel, levels = rev(levels(channel))))

fct_reorder(gg_all, date, .desc = TRUE)

mutate()

theme_set(theme_gdocs(base_size = 28)) 

elevatorgate <- as_date("2011-06-20")
gamergate <- as_date("2014-08-15")
atheismplus <- as_date("2012-08-19")



```




### Over Time

#### gg_dates

```{r}
gg_dates <- function(dataframe, name, events = F, width = 14, height = 10, facet = F, textsize = 18, linecolor = NA) {
  
  elevatorgate <- as_date("2011-06-20")
  gamergate <- as_date("2014-08-15")
  atheismplus <- as_date("2012-08-19")
  
  r_vs_sjw_all_time <- dataframe %>%
#  filter(date >= as.Date("2012-01-01")) %>% 
#  filter(channel != "Logicked") %>% 
  ggplot(aes(date, comment_prop, group = term, color = term)) + 
  scale_x_date() +
  scale_y_continuous(labels = scales::percent) +
  geom_point(aes(size = Views, alpha = 0.2)) +
  geom_smooth(color = linecolor) +
  guides(alpha = F) +
  theme_gdocs(base_size = textsize) +
  scale_color_fivethirtyeight(name = "Topic") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in the Skeptic Community") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video")
  if (events == T) {
    r_vs_sjw_all_time <- r_vs_sjw_all_time + 
      geom_segment(aes(elevatorgate, y = 0, 
                     xend = elevatorgate, 
                     yend = max(comment_prop)), 
                     linetype = 6, 
                     size = 1, 
                     color = "black") +
     annotate("text", 
             x = elevatorgate, 
             y = -0.02, 
             label = "''Elevatorgate''", 
             size = 7) +
     geom_segment(aes(gamergate, 
                     y = 0, 
                     xend = gamergate, 
                     yend = max(comment_prop)), 
                     linetype = 6, 
                     size = 1, 
                 color = "black") +
     annotate("text", 
             x = gamergate, 
             y = -0.02, 
             label = "''Gamergate''", 
             size = 7) +
     geom_segment(aes(atheismplus, 
                     y = 0, 
                     xend = atheismplus, 
                     yend = max(comment_prop)), 
                     linetype = 6, 
                     size = 1, 
                     color = "black") +
     annotate("text", 
             x = atheismplus, 
             y = 0.61, label = "''Atheism+''", 
             size = 7)
  }
  if (facet == T) {
     r_vs_sjw_all_time <- r_vs_sjw_all_time +
  facet_wrap(~channel + term, ncol = 2) 
  }

ggsave(r_vs_sjw_all_time, file = paste0("images/", name, ".png"), width = width, height = height)

return(r_vs_sjw_all_time)

}
```


```{r}


gg_all %>% 
  gg_dates(name = "r_vs_sjw_all_time", events = T)

gg_all %>% 
  gg_dates(name = "r_vs_sjw_all_time_f", 
           events = F,
           facet = T, 
           height = 15, 
           width = 12, 
           linecolor = "black") 

r_vs_sjw_all_time <- gg_all %>%
#  filter(date >= as.Date("2012-01-01")) %>% 
#  filter(channel != "Logicked") %>% 
  ggplot(aes(date, comment_prop, group = term, color = term)) + 
  scale_x_date() +
  geom_point(aes(size = Views, alpha = 0.2)) +
  geom_segment(aes(elevatorgate, y = 0, 
                   xend = elevatorgate, 
                   yend = max(comment_prop)), 
                   linetype = 6, 
                   size = 1, 
                   color = "black") +
  annotate("text", 
           x = elevatorgate, 
           y = -0.02, 
           label = "''Elevatorgate''", 
           size = 7) +
  geom_segment(aes(gamergate, 
                   y = 0, 
                   xend = gamergate, 
                   yend = max(comment_prop)), 
                   linetype = 6, 
                   size = 1, 
               color = "black") +
  annotate("text", 
           x = gamergate, 
           y = -0.02, 
           label = "''Gamergate''", 
           size = 7) +
  geom_segment(aes(atheismplus, 
                   y = 0, 
                   xend = atheismplus, 
                   yend = max(comment_prop)), 
                   linetype = 6, 
                   size = 1, 
                   color = "black") +
  annotate("text", 
           x = atheismplus, 
           y = 0.61, label = "''Atheism+''", 
           size = 7) +
  geom_smooth() +
  guides(alpha = F) +
  theme_gdocs(base_size = 18) +
  scale_color_fivethirtyeight(name = "Topic") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in the Skeptic Community") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video")

ggsave(r_vs_sjw_all_time, file = "images/r_vs_sjw_all_time.png", width = 14, height = 10)

r_vs_sjw_all_time

r_vs_sjw_all_time_f <- gg_all %>%
  mutate(Views = viewCount) %>% 
# filter(date >= as.Date("2012-01-01")) %>% 
#  filter(channel != "Logicked") %>% 
  ggplot(aes(date, comment_prop, group = term, color = term)) + 
  geom_point(aes(size = Views, alpha = 0.2)) +
  geom_smooth(color = "black") +
  guides(alpha = F) +
  theme_gdocs(base_size = 18) +
  scale_color_fivethirtyeight(name = "Topic") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in the Skeptic Community") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video") +
  facet_wrap(~channel + term, ncol = 2)

ggsave(r_vs_sjw_all_time_f, file = "images/r_vs_sjw_all_time_f.png", width = 12, height = 14)

r_vs_sjw_all_time_f


r_vs_sjw_all2 <- gg_all %>%
  mutate(Views = viewCount) %>% 
# filter(date >= as.Date("2012-01-01")) %>% 
#  filter(channel != "Logicked") %>% 
  ggplot(aes(date, comment_prop, group = term, color = term)) + 
  geom_point(aes(size = Views, alpha = 0.2)) +
  geom_smooth() +
  guides(alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Term") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in the Skeptic Community") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video") +
  facet_wrap(~channel, ncol = 1)

ggsave(r_vs_sjw_all2, file = "images/r_vs_sjw_all2.png", width = 10, height = 14)

r_vs_sjw_all2


r_vs_sjw_all3 <- gg_all %>%
  mutate(Views = viewCount) %>% 
  filter(date >= as.Date("2012-01-01")) %>% 
#  filter(channel != "Logicked") %>% 
  ggplot(aes(date, comment_prop, group = term, color = term)) + 
  geom_point(aes(size = Views, alpha = 0.2)) +
  geom_smooth() +
  guides(alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Term") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in the Skeptic Community") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video") +
  facet_wrap(~channel, ncol = 1)

ggsave(r_vs_sjw_all3, file = "images/r_vs_sjw_all3.png", width = 10, height = 14)

r_vs_sjw_all3
```

### Set 2

```{r}
r_vs_sjw_all4 <- gg_all %>%
  mutate(Views = viewCount) %>% 
# filter(date >= as.Date("2012-01-01")) %>% 
#  filter(channel != "Logicked") %>% 
  ggplot(aes(date, Views, group = term, color = term)) + 
  geom_point(aes(size = comment_prop, alpha = 0.00000000000000001)) +
  geom_smooth() +
  guides(alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Term") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in the Skeptic Community") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video") 

ggsave(r_vs_sjw_all4, file = "images/r_vs_sjw_all4.png")

r_vs_sjw_all4

r_vs_sjw_all5 <- gg_all %>%
  mutate(Views = viewCount) %>% 
#  filter(date >= as.Date("2013-01-01")) %>% 
  filter(Views < 4000000) %>% 
#  filter(channel != "Logicked") %>% 
#  filter(term == "SJW") %>% 
  ggplot(aes(comment_prop, Views, color = term)) + 
  geom_point(aes(alpha = 0.00000000000000001)) +
  geom_smooth(color = "black", method = "lm") +
  guides(alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Term") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in the Skeptic Community") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video") +
  facet_wrap(~term) +
  ggpubr::stat_cor()

ggsave(r_vs_sjw_all5, file = "images/r_vs_sjw_all5.png")

r_vs_sjw_all5_f <- gg_all %>%
  mutate(Views = viewCount) %>% 
#  filter(date >= as.Date("2013-01-01")) %>% 
  filter(Views < 4000000) %>% 
#  filter(channel != "Logicked") %>% 
#  filter(term == "SJW") %>% 
  ggplot(aes(comment_prop, Views, color = term)) + 
  geom_point(aes(alpha = 0.00000000000000001)) +
  geom_smooth(color = "black", method = "lm") +
  guides(alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Term") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in the Skeptic Community") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video") +
  facet_wrap(channel~term, ncol = 2, scales = "free_y") +
  ggpubr::stat_cor()

ggsave(r_vs_sjw_all5_f, file = "images/r_vs_sjw_all5_f.png", height = 14, width = 10)

r_vs_sjw_all5_f

r_vs_sjw_all6 <- gg_all %>%
  mutate(Views = viewCount) %>% 
  mutate(Likes = likeCount) %>% 
#  filter(date >= as.Date("2013-01-01")) %>% 
#  filter(Views < 4000000) %>% 
#  filter(channel != "Logicked") %>% 
#  filter(term == "SJW") %>% 
  ggplot(aes(comment_prop, Likes, color = term)) + 
  geom_point(aes(alpha = 0.00000000000000001)) +
  geom_smooth(color = "black", method = "lm") +
  guides(alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Term") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in the Skeptic Community") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video") +
  facet_wrap(~term) +
  ggpubr::stat_cor()

ggsave(r_vs_sjw_all6, file = "images/r_vs_sjw_all6.png")

r_vs_sjw_all6



r_vs_sjw_all6_f <- gg_all %>%
  mutate(Views = viewCount) %>% 
  mutate(Likes = likeCount) %>% 
#  filter(date >= as.Date("2013-01-01")) %>% 
#  filter(Views < 4000000) %>% 
#  filter(channel != "Logicked") %>% 
#  filter(term == "SJW") %>% 
  ggplot(aes(comment_prop, Likes, color = term)) + 
  geom_point(aes(alpha = 0.00000000000000001)) +
  geom_smooth(color = "black", method = "lm") +
  guides(alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Term") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in the Skeptic Community") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video") +
  facet_wrap(channel~term, ncol = 2, scales = "free_y") +
  ggpubr::stat_cor()

ggsave(r_vs_sjw_all6_f, file = "images/r_vs_sjw_all6_f.png", height = 14, width = 10)

r_vs_sjw_all6_f



r_vs_sjw_all7 <- gg_all %>%
  mutate(Views = viewCount) %>% 
  mutate(Likes = likeCount) %>% 
  mutate(Dislikes = dislikeCount) %>%   
#  filter(date >= as.Date("2013-01-01")) %>% 
#  filter(Views < 4000000) %>% 
  filter(Dislikes < 20000) %>% 
#  filter(channel != "Logicked") %>% 
#  filter(term == "SJW") %>% 
  ggplot(aes(comment_prop, Dislikes, color = term)) + 
  geom_point(aes(alpha = 0.00000000000000001)) +
  geom_smooth(color = "black", method = "lm") +
  guides(alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Term") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in the Skeptic Community") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video") +
  facet_wrap(~term) +
  ggpubr::stat_cor()

ggsave(r_vs_sjw_all7, file = "images/r_vs_sjw_all7.png")

r_vs_sjw_all7


r_vs_sjw_all7_f <- gg_all %>%
  mutate(Views = viewCount) %>% 
  mutate(Likes = likeCount) %>% 
  mutate(Dislikes = dislikeCount) %>%   
#  filter(date >= as.Date("2013-01-01")) %>% 
#  filter(Views < 4000000) %>% 
#  filter(Dislikes < 20000) %>% 
#  filter(channel != "Logicked") %>% 
#  filter(term == "SJW") %>% 
  ggplot(aes(comment_prop, Dislikes, color = term)) + 
  geom_point(aes(alpha = 0.00000000000000001)) +
  geom_smooth(color = "black", method = "lm") +
  guides(alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Term") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in the Skeptic Community") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video") +
  facet_wrap(channel~term, ncol = 2, scales = "free_y") +
  ggpubr::stat_cor()

ggsave(r_vs_sjw_all7_f, file = "images/r_vs_sjw_all7_f.png", height = 14, width = 10)

r_vs_sjw_all7_f




r_vs_sjw_all8 <- gg_all %>%
  mutate(Views = viewCount) %>% 
  mutate(Likes = likeCount) %>% 
  mutate(Dislikes = dislikeCount) %>%   
  mutate(Dislike_Ratio = Dislikes/(Likes + Dislikes)) %>% 
#  filter(date >= as.Date("2013-01-01")) %>% 
#  filter(Views < 4000000) %>% 
#  filter(Dislikes < 20000) %>% 
#  filter(channel != "Logicked") %>% 
#  filter(term == "SJW") %>% 
  ggplot(aes(comment_prop, Dislike_Ratio, color = term)) + 
  geom_point(aes(alpha = 0.00000000000000001)) +
  geom_smooth(color = "black", method = "lm") +
  guides(alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Term") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in the Skeptic Community") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video") +
  facet_wrap(~term) +
  ggpubr::stat_cor()

ggsave(r_vs_sjw_all8, file = "images/r_vs_sjw_all8.png")

r_vs_sjw_all8


r_vs_sjw_all8_f <- gg_all %>%
  mutate(Views = viewCount) %>% 
  mutate(Likes = likeCount) %>% 
  mutate(Dislikes = dislikeCount) %>%   
  mutate(Dislike_Ratio = Dislikes/(Likes + Dislikes)) %>% 
#  filter(date >= as.Date("2013-01-01")) %>% 
#  filter(Views < 4000000) %>% 
#  filter(Dislikes < 20000) %>% 
#  filter(channel != "Logicked") %>% 
#  filter(term == "SJW") %>% 
  ggplot(aes(comment_prop, Dislike_Ratio, color = term)) + 
  geom_point(aes(alpha = 0.00000000000000001)) +
  geom_smooth(color = "black", method = "lm") +
  guides(alpha = F) +
  theme_gdocs() +
  scale_color_fivethirtyeight(name = "Term") +
  ggtitle("Topics related to 'Religion' and 'SJWs' in the Skeptic Community") +
  xlab("Date when Video was published") +
  ylab("Percentage of Comments per Video") +
  facet_wrap(channel~term, ncol = 2, scales = "free_y") +
  ggpubr::stat_cor()

ggsave(r_vs_sjw_all8_f, file = "images/r_vs_sjw_all8_f.png", height = 14, width = 10)

r_vs_sjw_all8_f
```



# If I only knew.. unfortunately you only get 300 videos total

```{r}
a <- list_channel_resources(filter = c(channel_id = "UCjNxszyFPasDdRoD9J6X-sw
"), part = "contentDetails")

# Uploaded playlists:
playlist_id <- a$items[[1]]$contentDetails$relatedPlaylists$uploads

# Get videos on the playlist
vids <- get_playlist_items(filter = c(playlist_id = playlist_id)) 

# Video ids
vid_ids <- as.vector(vids$contentDetails.videoId)

map_df(vid_ids, get_stats)

head(res)


```

```{r}
dataframeFromJSON <- function(l) {
  l1 <- lapply(l, function(x) {
    x[sapply(x, is.null)] <- NA
    unlist(x)
  })
  keys <- unique(unlist(lapply(l1, names)))
  l2 <- lapply(l1, '[', keys)
  l3 <- lapply(l2, setNames, keys)
  res <- data.frame(do.call(rbind, l3))
  return(res)
}

  channel_id <- "UCjNxszyFPasDdRoD9J6X-sw"


getAllChannelVideos2 <- function(channel_id=NULL){
  
channelAct <- list_channel_resources(filter = c(channel_id = channel_id), part = "contentDetails")

playlist_id <- channelAct$items[[1]]$contentDetails$relatedPlaylists$uploads

df <- get_playlist_items(filter = c(playlist_id = playlist_id)) 

df_token <- list_channel_activities(filter = c(channel_id = channel_id), part = "contentDetails")
  
token <- df_token$nextPageToken

  repeat{
    channelActSub <- list_channel_resources(filter = c(channel_id = channel_id), 
                                            part = "contentDetails",page_token = token)

    df_tokenSub <- list_channel_activities(filter = c(channel_id = channel_id), 
                                           part = "contentDetails",page_token = token)
    
    playlist_id_sub <- channelActSub$items[[1]]$contentDetails$relatedPlaylists$uploads

    dff <- get_playlist_items(filter = c(playlist_id = playlist_id_sub)) 

    df <- smartbind(df, dff)
    
    print(df_tokenSub$nextPageToken)
    token <- df_tokenSub$nextPageToken
    if(is.null(token)){
      break
    }
    
  }
  return(df)
}

getAllChannelVideos2("UCjNxszyFPasDdRoD9J6X-sw")
```

```{r}
getAllChannelVideos("UCjNxszyFPasDdRoD9J6X-sw")
#list_channel_activities(filter = c(channel_id = "UCjNxszyFPasDdRoD9J6X-sw"), part = "contentDetails")
```
# More Trash

```{r}
# tryCatch.Rscript -- experiments with tryCatch
 
# Get any arguments
arguments <- commandArgs(trailingOnly=TRUE)
a <- arguments[1]
 
# Define a division function that can issue warnings and errors
myDivide <- function(d, a) {
  if (a == 'warning') {
    return_value <- 'myDivide warning result'
    warning("myDivide warning message")
  } else if (a == 'error') {
    return_value <- 'myDivide error result'
    stop("myDivide error message")
  } else {
    return_value = d / as.numeric(a)
  }
  return(return_value)
}
 
# Evalute the desired series of expressions inside of tryCatch
result <- tryCatch({
 
  b <- 2
  c <- b^2
  d <- c+2
  if (a == 'suppress-warnings') {
    e <- suppressWarnings(myDivide(d,a))
  } else {
    e <- myDivide(d,a) # 6/a
  }
  f <- e + 100
 
}, warning = function(war) {
 
  # warning handler picks up where error was generated
  print(paste("MY_WARNING:  ",war))
  b <- "changing 'b' inside the warning handler has no effect"
  e <- myDivide(d,0.1) # =60
  f <- e + 100
  return(f)
 
}, error = function(err) {
 
  # error handler picks up where error was generated
  print(paste("MY_ERROR:  ",err))
  b <- "changing 'b' inside the error handler has no effect"
  e <- myDivide(d,0.01) # =600
  f <- e + 100
  return(f)
 
}, finally = {
 
  print(paste("a =",a))
  print(paste("b =",b))
  print(paste("c =",c))
  print(paste("d =",d))
  # NOTE:  Finally is evaluated in the context of of the inital
  # NOTE:  tryCatch block and 'e' will not exist if a warning
  # NOTE:  or error occurred.
  #print(paste("e =",e))
 
}) # END tryCatch
 
print(paste("result =",result))

devtools::install_github("ColinFay/trycatchthis")
library(trycatchthis)
x <- 5
lol <- function(w){
 ss <- try_catch(2/2, 
          .e = ~ "There is an error")

 ss
}
lol(w = 2)

my_function <- function(input){
amazingatheist_comments <- list()
tryCatch({for (jj in seq_along(input)) {  
  amazingatheist_comments[[jj]] <- get_all_comments(amazingatheist_ids[jj])},
        ## But if an error occurs, do the following: 
        error=function(error_message) {
            message(paste("Video reached", baz))
            message("Here is the actual R error message:")
            message(error_message)
            return(NA)) 
  }})
cat(jj)
return(amazingatheist_comments)
}

amazingatheist_comments <- list()
for (jj in seq_along(amazingatheist_ids)) {
  tryCatch({
    amazingatheist_comments[[jj]] <- get_all_comments(amazingatheist_ids[jj])
  }, error = function(e){message(paste("Video reached", jj))
    })
      stopper <- jj
    cat(jj)

    repeat {
for (jj in stopper:length(amazingatheist_ids)) {
  tryCatch({
    amazingatheist_comments[[jj]] <- get_all_comments(amazingatheist_ids[jj])
  }, error = function(e){message(paste("Error. Last Video reached", jj))
    })
      stopper <- jj

}
          if(jj == length(amazingatheist_ids)){
      break
    }
    }

}
amazingatheist_comments


my_function <- function(baz){
    tryCatch(
        ## This is what I want to do:
      ss <- baz/2
        ,
        ## But if an error occurs, do the following: 
        error=function(error_message) {
            message(paste("Video reached", baz))
            message("Here is the actual R error message:")
            message(error_message)
            return(NA)
        }
    )
              return(ss)

}

my_function(c(2, 3, "dffd",4))

amazingatheist_comments[[1]] <- get_all_comments(amazingatheist_ids[1])

ww <- seq(45,1438, 41)
bb <- seq(85,length(amazingatheist_ids), 41)
ww <- ww[1:34] 
amazingatheist_comments1 <- list()



amazingatheist_comments1 <- get_all_comments(amazingatheist_ids[86:126])
amazingatheist_comments1 <- get_all_comments(amazingatheist_ids[127:167])
amazingatheist_comments1 <- get_all_comments(amazingatheist_ids[168:208])
amazingatheist_comments1 <- get_all_comments(amazingatheist_ids[45:85])
amazingatheist_comments1 <- get_all_comments(amazingatheist_ids[45:85])
amazingatheist_comments1 <- get_all_comments(amazingatheist_ids[45:85])
amazingatheist_comments1 <- get_all_comments(amazingatheist_ids[45:85])


length(amazingatheist_ids)

save(amazingatheist_comments, file = "data/amazingatheist_comments.Rdata")

amazingatheist_ids[1:20]

amazingatheist_comments <- get_all_comments(video_id = "WL6bImDYhlQ")

```


# Trash Links for Google API

https://www.googleapis.com/youtube/v3/search?key=AIzaSyDmV5jHx7c8GeAmpTkv6To_ERdkZ_HNl70&channelId=UC-yewGHQbNFpDrGM0diZOLA
&part=snippet,id&order=date&maxResults=500

https://www.googleapis.com/youtube/v3/channels?id=UC-yewGHQbNFpDrGM0diZOLA
&key=AIzaSyDmV5jHx7c8GeAmpTkv6To_ERdkZ_HNl70&part=contentDetails

https://www.googleapis.com/youtube/v3/playlistItems?playlistId=UU-yewGHQbNFpDrGM0diZOLA&key=AIzaSyDmV5jHx7c8GeAmpTkv6To_ERdkZ_HNl70&part=snippet&maxResults=100

https://www.googleapis.com/youtube/v3/channels?part=contentDetails&channelId=UC-yewGHQbNFpDrGM0diZOLA&key=AIzaSyDmV5jHx7c8GeAmpTkv6To_ERdkZ_HNl70

https://www.googleapis.com/youtube/v3/channels?part=contentDetails&forUsername=MillennialWoes&key=AIzaSyDmV5jHx7c8GeAmpTkv6To_ERdkZ_HNl70

https://www.googleapis.com/youtube/v3/playlistItems?part=snippet%2CcontentDetails&maxResults=50&playlistId=UU-yewGHQbNFpDrGM0diZOLA&key=AIzaSyDmV5jHx7c8GeAmpTkv6To_ERdkZ_HNl70&pageToken=2

nextPageToken 


https://www.googleapis.com/youtube/v3/playlistItems?part=snippet%2CcontentDetails&maxResults=50&playlistId=UULfhh63n0fWn0gXXKQ5NWvw&key=AIzaSyDmV5jHx7c8GeAmpTkv6To_ERdkZ_HNl70

UCLfhh63n0fWn0gXXKQ5NWvw


"http://youtube.com/watch?

# retry function

```{r}
library(futile.logger)
library(utils)

retry <- function(expr, isError=function(x) "try-error" %in% class(x), maxErrors=5, sleep=0) {
  attempts = 0
  retval = try(eval(expr))
  while (isError(retval)) {
    attempts = attempts + 1
    if (attempts >= maxErrors) {
      msg = sprintf("retry: too many retries [[%s]]", capture.output(str(retval)))
      flog.fatal(msg)
      stop(msg)
    } else {
      msg = sprintf("retry: error in attempt %i/%i [[%s]]", attempts, maxErrors, 
                    capture.output(str(retval)))
      flog.error(msg)
      warning(msg)
    }
    if (sleep > 0) Sys.sleep(sleep)
    retval = try(eval(expr))
  }
  return(retval)
}

test <- function(ids, jj) {
  thunder_comments <- list()
  for (jj in seq_along(ids)) {  
  thunder_comments[[jj]] <- get_all_comments2(ids[jj])
  cat(paste0("\t",jj))
  BRRR::skrrrahh(jj)
  }
return(thunder_comments)
}

ss <- thunder_ids[1:4]

ss <- c(ss,"nix", ss)



devtools::install_github("brooke-watson/BRRR")
library(BRRR)



thunder_comments <- list()
for (jj in seq_along(ss)) { 
    while (TRUE) {
       df <- try(  
         thunder_comments[[jj]] <- get_all_comments2(ss[jj]), 
  silent = F)
       cat(paste0("\t",jj))
       BRRR::skrrrahh(jj)
       if (!is(df, 'try-error')) break
       if (str_detect(df, "HTTP failure: ")) stop("Was hier loooos")
    }
  ff <- bind_rows(df) 

}


bind_rows(ff)
unique(ff$videoId)
class(df)

str_detect(df, "HTTP failure: 404")



```

